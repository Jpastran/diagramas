<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <script type="text/javascript" src="../assets/javascript/jquery-1.11.0.min.js"></script>
        <title>Test Tabs</title>
        <style>
            body {
                background: #D2D2D2;
            }
            #tabs {
                font-size: 3ex;
                font-weight: bold;
                position: relative;
            }
            #tabs ul {
                margin-left: -40px;
            }
            #tabs li {
                background: darkgrey;
                border-top-left-radius: 5px;
                border-top-right-radius: 5px;
                border: 2px solid bisque;
                border-bottom: dimgray;
                list-style-type: none;
                float: left;
                text-align: center;
                margin: 0px 2px -2px -0px;
                background: darkgrey;
                padding: 0px 20px 0px 20px;
            }
            #tabs a:link {
                text-decoration: none;
                color: bisque;
            }
            #ctabs {
                clear: both;
                background: #EFEFEF;
                padding: 20px;
            }
            #a {
                border: 1px solid #E5E5E5;
                background-repeat: repeat;
                background-color: #FFFFFF;
            }
            table {
                border: 2px solid #ddd;
                width: 100%;
                border-spacing: 0;
                border-collapse: collapse;
            }

            table img {
                vertical-align: -10px;
            }
            td, th {
                border: 2px solid #ddd;
                min-width: 30px;
                max-width: 150px;
                line-height: 1.42857143;
                padding: 3px;
            }
            .edit {
                background: #F6F6F6;
            }
        </style>
        <script type="text/javascript">
            $(document).ready(function() {
                tabs(tab2, ctab2);
                editable();

            });
            //http:programandoointentandolo.com/2012/11/como-crear-pestanas-con-html.html
            function tabs(li, div) {
                //Se ocultan todos los contenedores
                var i = 1;
                while (document.getElementById("ctab" + i) != null) {
                    $("#" + "ctab" + i).css('display', 'none');
                    i += 1;
                }
                i = 1;
                //Se restaura el fondo de las pestañas
                while (document.getElementById("tab" + i) != null) {
                    $("#" + "tab" + i).css('background', '');
                    $("#" + "tab" + i).css('padding-bottom', '');
                    i += 1;
                }

                //Aplica el fondo a la pestaña activa
                $(li).css('background', 'dimgray');
                $(li).css('padding-bottom', '2px');

                //Activa el contedino solicitado
                $(div).css('display', '');
            }

            function editable() {
                var tds = $("#ctabs td");
                for (var i = 0; i < tds.length; i++) {
                    if ($(tds[i]).html() == "") {
                        $(tds[i]).attr('contenteditable', 'true');
                        $(tds[i]).attr('class', 'edit');
                        $(tds[i]).attr('id', 'td' + i);
                    }
                }
            }

            var resp = [];

            function obtener() {
                var edits = $(".edit");
                for (var i = 0; i < edits.length; i++) {
                    if ($(edits[i]).text() != "") {
                        console.log($(edits[i]).text());
                    }
                    resp[i] = $(edits[i]).text();
                }
            }

            function cargar(datos) {
                var edits = $(".edit");
                for (var i = 0; i < edits.length; i++) {
                    if (datos[i] != "") {
                        console.log(datos[i]);
                    }
                    $(edits[i]).text(datos[i]);
                }
            }

            function cambiaCtab(li, ctab) {
                //Obtenemos los id de los objetos
                var li = $(li).attr('id');
                var ctab = $(ctab).attr('id');
                //Crea la nueva ruta de la pestaña
                var href = "javascript:tabs(" + li + "," + ctab + ")";
                //Busca la url de la pestaña y la cambia
                $($("#" + li).children('a')).attr('href', href);
            }

            function genResumen() {
                var array = ['', 'Operacion', 'Trasprote', 'Demora', 'Sostenimiento', 'Total', 'Tiempo del ciclo'];
                var tbody = $("#gen");
                for (var i = 0; i < array.length; i++) {
                    var tr = $('<tr>');
                    console.log(array[i], i);
                    if (i != 0) {
                        tr.append($('<td>' + array[i] + '</td>'));
                    }
                    for (var j = 0; j < 3; j++) {
                        if (i == 0) {
                            tr.append($('<td>M.I</td>'));
                            tr.append($('<td>M.D</td>'));
                        } else {
                            tr.append($('<td>'));
                            tr.append($('<td>'));
                        }
                    }
                    tbody.append(tr);
                }
            }

            function addFila() {
                var table = $('#bimanualT').find('tbody');
                var tr = $('<tr>');
                tr.append($('<td>' + $('#time').val() + '</td>'));
                tr.append($('<td>' + $('#mid').val() + '</td>'));
                tr.append($('<td><img src="../lib/sets/bimanual/' + opr[$('#mis').val()] + '"/></td>'));
                tr.append($('<td><img src="../lib/sets/bimanual/' + opr[$('#mds').val()] + '"/></td>'));
                tr.append($('<td>' + $('#mdd').val() + '</td>'));
                tr.append($('<td>' + $('#time').val() + '</td>'));
                var td = $('<td>');
                td.append($('<input/>', {type: 'button', value: 'Editar'}).click(editFila));
                td.append($('<input type="button" value="Borrar">').click(delFila));
                tr.append(td);
                table.append(tr);
            }

            function delFila() {
                console.log('Borrar');
                $(this).parent('td').parent('tr').remove();
            }

            var tds;
            var opr = ['circle.png', 'arrow.png', 'triangle_inver.png', 'semi_circle_right.png'];

            function genSelect() {
                var sel = $('<select>');
                sel.append($('<option value="0">Operacion</option>'));
                sel.append($('<option value="1">Trasporte</option>'));
                sel.append($('<option value="2">Sostenimiento</option>'));
                sel.append($('<option value="3">Demora</option>'));
                return sel;
            }

            function genImg(td) {
                var val = $(td).find('select').val();
                var img = $('<img src="../lib/sets/bimanual/' + opr[val] + '"/>');
                return img;
            }

            function editFila() {
                console.log('Editar');
                tds = $(this).parent('td').parent('tr').find('td');
                for (var i = 0; i < tds.length - 2; i++) {
                    if (i != 2 && i != 3) {
                        $(tds[i]).attr('contenteditable', true);
                        $(tds[i]).attr('class', 'edit');
                    }
                }
                disBtn(true);
                $(tds[2]).html(genSelect());
                $(tds[3]).html(genSelect());
                $(this).unbind();
                $(this).attr('value', 'Guardar');
                $(this).attr('disabled', false);
                $(this).click(modFila);
            }

            function modFila() {
                if (valFila()) {
                    console.log('Modificar');
                    for (var i = 0; i < tds.length - 2; i++) {
                        $(tds[i]).removeAttr('contenteditable');
                        $(tds[i]).removeAttr('class');
                    }
                    disBtn(false);
                    $(this).unbind();
                    $(tds[2]).html(genImg(tds[2]));
                    $(tds[3]).html(genImg(tds[3]));
                    $(this).attr('value', 'Editar');
                    $(this).click(editFila);
                    tds[5].textContent = tds[0].textContent;
                } else {
                    alert('Complete correctamente los campos');
                }
            }

            function disBtn(bool) {
                var input = $('#bimanualT').find('input');
                for (var i = 0; i < input.length; i++) {
                    $(input[i]).attr("disabled", bool);
                }
            }

            function valFila() {
                var bool = true;
                for (var i = 0; i < tds.length - 2; i++) {
                    if (tds[i].textContent == '') {
                        bool = false;
                    }
                }
                return bool;
            }

            function editTime() {
                $('#tR').html($('#tL').val());
            }
        </script>
    </head>
    <body>
        <div class="contenedor">
            <div class="titulo">
                ¿Sobre que escribiré en el blog?
            </div>
            <div>
                Tiempo
                <input type="text" id="time">
                Descripcion mano izquierda
                <input type="text" id="mid">
                Simbolo mano izquierda
                <select id="mis">
                    <option value="0">Operacion</option>
                    <option value="1">Trasporte</option>
                    <option value="2">Sostenimiento</option>
                    <option value="3">Demora</option>
                </select>
                Descripcion mano derecha
                <input type="text" id="mdd">
                Simbolo mano izquierda
                <select id="mds">
                    <option value="0">Operacion</option>
                    <option value="1">Trasporte</option>
                    <option value="2">Sostenimiento</option>
                    <option value="3">Demora</option>
                </select>
                <input type="button" value="Insertar" onclick="addFila()">
            </div>
            <div id="tabs">
                <ul id=lista>
                    <li id="tab1">
                        <a href='javascript:tabs(tab1,ctab1)'>Cabecera</a>
                    </li>
                    <li id="tab2">
                        <a href='javascript:tabs(tab2,ctab2)'>Tabla</a>
                    </li>
                </ul>
            </div>
            <div id="ctabs">
                <div id="ctab1">
                    <table id="bimanualH">
                        <tbody id="gen">
                            <tr>
                                <td>Diagrama No:</td>
                                <td></td>
                                <td>Hoja No:</td>
                                <td></td>
                                <td>De:</td>
                                <td></td>
                                <td>Fecha:</td>
                                <td colspan="6"></td>
                            </tr>
                            <tr>
                                <td rowspan="2">Actividad:</td>
                                <td colspan="5" rowspan="2"></td>
                                <td>Analista:</td>
                                <td colspan="6"></td>
                            </tr>
                            <tr>
                                <td colspan="3">Metodo Presente
                                    <input type="radio" name="metodo"/>
                                </td>
                                <td colspan="4">Metodo Propuesto
                                    <input type="radio" name="metodo"/>
                                </td>
                            </tr>
                            <tr>
                                <td align="center" colspan="6">Puesto de trabajo</td>
                                <td align="center" colspan="7">Resumen</td>
                            </tr>
                            <tr>
                                <td colspan="6" rowspan="8"></td>
                                <td align="center" rowspan="2">Simbolo</td>
                                <td align="center" colspan="2">Presente</td>
                                <td align="center" colspan="2">Propuesto</td>
                                <td align="center" colspan="2">Ganado</td>
                            </tr>
                            <tr>
                                <td>M.I</td>
                                <td>M.D</td>
                                <td>M.I</td>
                                <td>M.D</td>
                                <td>M.I</td>
                                <td>M.D</td>
                            </tr>

                            <tr>
                                <td>Operacion</td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>Trasporte</td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>Demora</td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>Sostenimiento</td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>Total</td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>Tiempo del ciclo</td>
                                <td colspan="2"></td>
                                <td colspan="2"></td>
                                <td colspan="2"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div id="ctab2">
                    <table id="bimanualT">
                        <thead>
                            <tr>
                                <th>Tiempo</th>
                                <th>Descrpcion de la actividad de</th>
                                <th colspan="2">Simbolo</th>                                
                                <th>Descrpcion de la actividad de</th>
                                <th>Tiempo</th>
                                <th rowspan="2">Opciones</th>
                            </tr>
                            <tr>
                                <th>
                                    <select id="tL" onchange="editTime()">
                                        <option value="Seg" selected>Seg</option>
                                        <option value="Min">Min</option>
                                        <option value="Hora">Hora</option>
                                    </select>
                                </th>
                                <th>Mano izquierda</th>
                                <th>MI</th>
                                <th>MD</th>
                                <th>Mano derecha</th>
                                <th id="tR">Seg</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
                <div id="ctab3">
                </div>
            </div>
        </div>
    </body>
</html>